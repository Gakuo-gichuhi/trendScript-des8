{% extends "base.html" %}
{% load static monetize_tags %}
{% block title %}{{ blog.Title }} | TrendScript{% endblock %}

{% block extra_css %}
<style>
/* Blog Title */
.blog-title {
    text-align: center;
    font-family: 'Poppins', sans-serif;
    color: #27AE60;
    font-weight: 600;
    margin-bottom: 1rem;
}

/* Post Box */
.post-box {
    background: #F5DEB3;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 0 12px rgba(0,0,0,.08);
    margin: 2rem 0;
}

/* Blog Image */
.yt-image {
    width: 100%;             /* Fills the container width */
    aspect-ratio: 16 / 9;    /* Standard YouTube 720p/1080p ratio */
    object-fit: contains;       /* 'cover' is better than 'contains' to avoid black bars */
    display: block;          /* Removes extra bottom whitespace */
    border-radius: 12px;
    object-position: top;
    margin: 0 auto 20px auto;
    cursor: pointer;
    transition: transform 0.2s;
}
.yt-image:hover { transform: scale(1.03); }

/* Affiliate Button */
.affiliate-btn {
    background: #ffd44d;
    padding: 12px 20px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: bold;
}
.affiliate-btn:hover { opacity: 0.8; }

/* Sponsored Badge */
.sponsored-badge {
    background: #ffea4d;
    padding: 8px 12px;
    border-radius: 6px;
    display: inline-block;
    font-weight: bold;
    margin-bottom: 15px;
}

/* Affiliate Disclosure */
.affiliate-disclosure {
    background: #fff6c7;
    padding: 10px;
    border-left: 4px solid #ffd633;
    margin-bottom: 20px;
    font-size: 14px;
}

/* Related / All Posts Grid */
.all-posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 2rem;
}
.post-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,.08);
    overflow: hidden;
    transition: transform 0.2s;
}
.post-card:hover { transform: translateY(-5px); }
.post-card img {
    width: 100%;             /* Fills the container width */
    aspect-ratio: 16 / 9;    /* Standard YouTube 720p/1080p ratio */
    object-fit: contains;       /* 'cover' is better than 'contains' to avoid black bars */
    display: block;          /* Removes extra bottom whitespace */
    border-radius: 12px;
    object-position: top;
    cursor: pointer;
    transition: transform 0.2s;
}
.post-card img:hover { transform: scale(1.05); }
.post-card-content { padding: 12px; }
.post-card-content h5 { font-weight: 600; margin-bottom: 6px; }
.post-card-content p { font-size: 14px; color: #555; }

/* Responsive */
@media (max-width: 992px) {
    .post-box { padding: 1.5rem; }
    .yt-image { max-width: 100%; }
}
</style>
{% endblock %}

{% block body %}
<div class="container">
    <!-- Blog Title -->
    <h2 class="blog-title">{{ blog.Title }}</h2>

    <!-- Sponsored Badge -->
    {% if blog.is_sponsored %}
    <div class="sponsored-badge">
        Sponsored by {{ blog.sponsor_name }}
    </div>
    {% endif %}

    <!-- Affiliate Disclosure -->
    {% if blog.affiliate_link %}
    <div class="affiliate-disclosure">
        This post contains affiliate links. We may earn a commission at no extra cost to you.
    </div>
    {% endif %}

    <!-- Blog Image -->
    {% if blog.Image %}
    <a href="{{ blog.Image.url }}">
        <img src="{{ blog.Image.url }}" class="yt-image" alt="{{ blog.Title }}">
    </a>
    {% endif %}

    <!-- Blog Content -->
    <div class="post-box blog_content">
        {{ blog.Content.html|safe }}
    </div>

    <!-- Affiliate Button -->
    {% if blog.affiliate_link %}
    <div class="mb-4">
        <a href="{{ blog.affiliate_link }}" rel="sponsored" class="affiliate-btn">
            {{ blog.affiliate_text|default:"Check Latest Price" }}
        </a>
    </div>
    {% endif %}

    <hr>

    <!-- Related / All Posts Grid -->
    <h4 class="mt-5">More Posts</h4>
    <div class="all-posts-grid">
        {% for p in all_posts %}
        <div class="post-card">
            <a href="{% url 'blog:blogpost' p.Slug %}">
                {% if p.Image %}
                <img src="{{ p.Image.url }}" alt="{{ p.Title }}">
                {% endif %}
            </a>
            <div class="post-card-content">
                <h5>
                    <a href="{% url 'blog:blogpost' p.Slug %}" class="text-dark text-decoration-none">{{ p.Title }}</a>
                </h5>
                <p>{{ p.Content.plain|truncatechars:100 }}</p>
            </div>
        </div>
        {% empty %}
        <p>No more posts.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
